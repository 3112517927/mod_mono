Last updated: April 8, 2004

INSTALLING mod_mono
--------------------

  The following are instructions on getting mod_mono working with
  Apache, either 1.3 or 2. Once you set it up, Apache will be able to
  serve ASP.NET pages.

  You will need:

    * mono (http://www.go-mono.com)
    * apache 1.3 or 2 and its development package. Usually called
    apache2-dev, apache-dev... If you want to install this from source
    see Appendix A.
    * Latest xsp and mod_mono tarballs (http://go-mono.com/download.html)

  Then follow these steps to install everything in /usr. Notice that You
  will need to be root to do 'make install' in this directory:

  1. Install xsp.
    
             tar -xzvf xsp-X.Y.Z.tar.gz
             cd xsp-X.Y.Z
             ./configure --prefix=/usr
             make
             make install

       This will install xsp.exe and mod-mono-server.exe in /usr/bin and a
       few samples in /usr/share/doc/xsp/test.

  2. Install mod_mono.

             tar xvfz mod_mono-X.Y.Z.tgz
             cd mod_mono-X.Y.Z
   (*)       ./configure --prefix=/usr
             make
             make install

       (*) If it complains about not finding apxs because you installed
       apache in a non-common directory, use the --with-apxs argument.
       Example:

         ./configure --prefix=/usr --with-apxs=/home/user/httpd/bin/apxs

       (Apache 2 only) If you get errors while compiling due to apr.h
       header not found, you'll need to use the --with-apr-config option
       and provide the full path to 'apr-config':

         ./configure --prefix=/usr --with-apr-config=/usr/bin/apr-config

       After this step, the module is installed in the proper location and
       the apache configuration file has been updated to load the module.

  3. Configure apache.

       We're going to configure apache so that we can browse the samples
       that we installed in step 1 under /usr/share/doc/xsp/test.

       Edit your httpd.conf file, which should be in /etc/httpd,
       /etc/apache, /etc/apache2...

       Add the following lines:

            Alias /mono "/usr/share/doc/xsp/test"
	    MonoApplications "/mono:/usr/share/doc/xsp/test"

       so that apache redirects requests from /mono to /mono/ and looks
       for everything requested as /mono/xxx under
       /usr/share/doc/xsp/test/xxx.

       For Apache 1.3 and, optionally, for Apache 2.0, add these lines:

            <Directory /usr/share/doc/xsp/test>
	           SetHandler mono
                   <IfModule mod_dir.c>
                         DirectoryIndex index.aspx
                   </IfModule>
            </Directory>

       If you are using Apache 2.0, you can use get the same results with
       this:

            <Location /mono>
	          SetHandler mono
            </Location>

	Take a look at Appendix B below for typical configuration
	samples and Appendix C for detailed descriptions on
	available configuration directives.

	Assuming you have installed mono and mod-mono-server.exe in /usr
	prefix, you don't have to do anything else.
    
  4. Run mod-mono-server.

       This step is OPTIONAL. With the default configuration and
       everything intalled in /usr. The module will spawn
       mod-mono-server.exe when needed.

       If you still want to run it manually, do:

         cd /usr/share/doc/xsp/test
	 mono /usr/bin/mod-mono-server.exe --root . --applications /mono:.

       The --root argument tells mod-mono-server to change the directory
       to this one before anything else.

       The --applications argument makes mod-mono-server set up an
       application that will be rooted on /mono/ virtual directory.

       Once you're running this, a file is created in
       /tmp/mod_mono_server. This is the default file name and location.

       Make sure that both apache and mod-mono-server have write
       permission to that file.
	
       One way of achieving this by running mod-mono-server under the same
       user as apache or changing the permissions of the file to 666, ie.,
       run:
       
               chmod 666 /tmp/mod_mono_server

	*AFTER* mod-mono-server is started.

  5. Restart apache.

  6. Point your browser to http://127.0.0.1/mono/index.aspx

  Nice, huh?

       
APPENDIX A: installing Apache from source
------------------------------------------

  Go to http://www.apache.org and download Apache 2, the filename will
  be something like httpd-2.0.43.tar.gz

  Unpack it:

      tar xvfz httpd-2.0.43.tar.gz
      cd httpd-2.0.43
      ./configure --prefix=/home/username/apache2 --enable-so
      make 
      make install

APPENDIX B: Typical configuration
-------------------------------------------------

  This samples assume that you have mono and mod-mono-server installed
  in /usr prefix. If you installed them in other place, take a look at
  Appendix C.

  In Apache 1.3 you will end up with something like:

      LoadModule mono_module /usr/lib/apache/1.3/libmod_mono.so
      AddModule mod_mono.c
      Alias /mono "/usr/share/doc/xsp/test"
      MonoApplications "/mono:/usr/share/doc/xsp/test"
      <Directory /usr/share/doc/xsp/test>
              SetHandler mono
              <IfModule mod_dir.c>
                    DirectoryIndex index.aspx
              </IfModule>
      </Directory>

  With Apache 2.0 you will have something like:

      LoadModule mono_module modules/libmod_mono.so
      Alias /mono "/usr/share/doc/xsp/test"
      MonoApplications "/mono:/usr/share/doc/xsp/test"
      <Directory /usr/share/doc/xsp/test>
              SetHandler mono
      </Directory>

  or like:

      LoadModule mono_module modules/libmod_mono.so
      Alias /mono "/usr/share/doc/xsp/test"
      <Location /mono>
              SetHandler mono
      </Location>

  If you don't want mod-mono-server to handle all the files, but only
  ASP.NET ones, you can replace the 'SetHandler mono' by:

       AddHandler mono .aspx .ascx .asax .ashx .config .cs .asmx

  but this will break PathInfo

APPENDIX C: Configuration directives for mod_mono
---------------------------------------------------

  These are the directives supported under both apache 1.3 and 2.0:
  
  MonoUnixSocket

    It accepts a file name as argument. That file will be a named pipe
    used to send/receive data from/to mod_mono to/from mod-mono-server.
    Default value: "/tmp/mod_mono_server".

  MonoRunXSP

    If the value is True, it tells mod_mono to spawn mod-mono-server.exe
    if it's not already running. If set to False, mod_mono won't do
    that.
    Default value: True

  MonoExecutablePath (used only when MonoRunXSP is True)

    The full path to mono executable.
    Default value: "/usr/bin/mono"

  MonoPath (used only when MonoRunXSP is True)

    This value will be used to set the MONO_PATH environment variable.
    Default value: ""

  MonoServerPath (used only when MonoRunXSP is True)

    The full path to mod-mono-server.exe.
    Default value: "/usr/bin/mod-mono-server.exe"

  MonoApplications (used only when MonoRunXSP is True)
  
    This value will be passed to mod-mono-server.exe in the
    --applications option. It is mandatory if MonoRunXSP is True.

  MonoWapiDir

    The directory where mono runtime will create the ".wapi" directory
    used to emulate windows I/O. It's used to set MONO_SHARED_DIR.
    Default value: "/tmp"


CREDITS
--------

  Daniel Lopez Ridruejo <daniel @ rawbyte.com> 
  http://www.apacheworld.org

  Gonzalo Paniagua Javier <gonzalo @ ximian.com>

